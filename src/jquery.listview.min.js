/*
* ListView 1.0 plugin!
* @requires jQuery v1.8.3+
*
* Copyright (c) 2013 Man Nguyen
* Licences: MIT
* Feel free to use or modify this plugin as far as my full name is kept
*
* @type jQuery
* @name listView
* @author Man Nguyen
* @remark pScroll work on IE9 but it does show scroll. Dawn crappy IE.
*/
(function(a){a.fn.listView=function(f){var b=a(this),h;h=a.extend({data:[],optionItems:[],pScrollEnable:false},f);b.bind("mousewheel DOMMouseScroll",function(k){var l=k.originalEvent,j=l.wheelDelta||-l.detail;this.scrollTop+=(j<0?1:-1)*30;k.preventDefault()});function c(k,j){if(typeof j==="function"){j(row)}}function d(j){var k=b.find(".jListItemSelected").index();console.log(JSON.stringify(h.data[k]));if(typeof j==="function"){j(row)}return h.data[k]}function g(j){b.empty();if(typeof j==="function"){j(row)}}function i(j,k){if(j.length>0){a("div",k).removeClass("jListItemSelected");j.addClass("jListItemSelected").focus()}}function e(){b.addClass("jListView").attr("tabindex",0);var m="";if(h.data.length>0&&typeof h.data[0]==="object"){if(Object.keys){m=(b.width()/Object.keys(h.data[0]).length)-15}else{var l=[];a.each(this.opts.data[0],function(n,o){l.push(n)});m=(b.width()/l.length)-15}}for(var k=0;k<h.data.length;k++){var j=a('<div class="jListOption" tabindex="-1">');if(typeof h.data[k]==="object"){a.each(h.data[k],function(o,q){var p=a.grep(h.optionItems,function(r){return r.id===o});if(typeof p[0].formatter=="function"){var n=a(p[0].formatter(true));if(p[0].width!==undefined){n.css("width",p[0].width+"px")}if(p[0].cssClass!==undefined){n.addClass(p[0].cssClass)}n.addClass("jListOptItem");n.append(q);j.append(n)}else{j.append('<span class="jListOptItem" style="width: '+m+'px;">'+q+"</span>")}})}else{$span.append(opt.data[k]);j.append($span)}j.click(function(n){a("div",b).removeClass("jListItemSelected");a(this).addClass("jListItemSelected");a(this).parent().focus()});j.attr("data-id","");b.append(j);if(k<(h.data.length-1)||h.data.length===1){j.css("border-bottom","1px solid #c0c0c0")}}}return this.each(function(){var j=a(this);e();j.unbind("addItem updtItem setItems getItem removeItem removeAll focusin").bind("addItem",function(l,m,k){c(m,k)}).bind("updtItem",function(m,l,k){UpdateSchedule(l)}).bind("setItems",function(l,m,n,k){SetSchedule(m,n,k)}).bind("getItem",function(l,k){return d(k)}).bind("removeItem",function(k){removeItem()}).bind("removeAll",function(l,k){g(k)});j.on("focusout",function(k){a("body").unbind("keydown")}).on("focus",function(l){var k=new Array(33,34,35,36,37,38,39,40);a("body").bind("keydown",function(m){var n=m.which;if(a.inArray(n,k)>-1){m.preventDefault();return false}return true})}).on("keyup",function(n){var m=j.find(".jListItemSelected");if(m.length===0&&(n.keyCode==38||n.keyCode==40)){j.find(".jListOption").first().addClass("jListItemSelected");return}if(n.keyCode==38){var l=m.prev(".jListOption");i(l,j)}else{if(n.keyCode==40){var k=m.next(".jListOption");i(k,j)}}j.focus()});if(h.pScrollEnable&&a().perfectScrollbar!==undefined){j.css("overflow","hidden");j.css("position","relative");j.perfectScrollbar({wheelSpeed:20,wheelPropagation:false})}else{j.css("overflow","auto");j.css("display","block")}})}})(jQuery);