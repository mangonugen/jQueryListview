/*
* ListView 1.0 plugin!
* @requires jQuery v1.8.3+
*
* Copyright (c) 2013 Man Nguyen
* Licences: MIT
* Feel free to use or modify this plugin as far as my full name is kept
*
* @type jQuery
* @name listView
* @author Man Nguyen
* @remark pScroll work on IE9 but it does show scroll. Dawn crappy IE.
*/
(function(a,b,f){var e="jq-listView";function d(g,i){this.$el=a(g);this.defaults={data:[],optionItems:[],pScrollEnable:false};var h=this.$el.data(e+"-opts");this.opts=a.extend({},this.defaults,i);a.extend(this,{listViewVersion:"1.0",init:c});this.init()}d.prototype=new a.Event("");function c(){this.$el.addClass("jListView").attr("tabindex",0);var m="",h=this.$el,l=this.opts;if(this.opts.data.length>0&&typeof this.opts.data[0]==="object"){if(Object.keys){m=(this.$el.width()/Object.keys(this.opts.data[0]).length)-15}else{var k=[];a.each(this.opts.data[0],function(i,n){k.push(i)});m=(this.$el.width()/k.length)-15}}for(var j=0;j<this.opts.data.length;j++){var g=a('<div class="jListOption" tabindex="-1">');if(typeof this.opts.data[j]==="object"){a.each(this.opts.data[j],function(n,p){var o=a.grep(l.optionItems,function(q){return q.id===n});if(typeof o[0].formatter=="function"){var i=a(o[0].formatter(true));if(o[0].width!==undefined){i.css("width",o[0].width+"px")}if(o[0].cssClass!==undefined){i.addClass(o[0].cssClass)}i.addClass("jListOptItem");i.append(p);g.append(i)}else{g.append('<span class="jListOptItem" style="width: '+m+'px;">'+p+"</span>")}})}else{$span.append(l.data[j]);g.append($span)}g.click(function(i){a("div",h).removeClass("jListItemSelected");a(this).addClass("jListItemSelected");a(this).parent().focus()});g.attr("data-id","");this.$el.append(g);if(j<(this.opts.data.length-1)||this.opts.data.length===1){g.css("border-bottom","1px solid #c0c0c0")}}this.binding();this.preventPageScroll()}d.prototype={updateSelectItem:function(g){if(g.length>0){a("div",this.$el).removeClass("jListItemSelected");g.addClass("jListItemSelected").focus()}this.$el.focus()},destroy:function(){this.$el.removeData(e);this.$el=null},preventPageScroll:function(){this.$el.on("mousewheel DOMMouseScroll",function(h){var i=h.originalEvent,g=i.wheelDelta||-i.detail;this.scrollTop+=(g<0?1:-1)*30;h.preventDefault()})},getItem:function(g){var h=this.$el.find(".jListItemSelected").index();console.log(JSON.stringify(this.opts.data[h]));if(typeof g==="function"){g(row)}return this.opts.data[h]}};d.prototype.binding=function(){var g=this;this.$el.unbind("addItem updtItem setItems getItem removeItem removeAll").bind("addItem",function(i,j,h){}).bind("updtItem",function(j,i,h){}).bind("setItems",function(i,j,k,h){}).bind("getItem",function(i,h){return g.getItem(h)}).bind("removeItem",function(h){}).bind("removeAll",function(i,h){});this.$el.on("focusout",function(h){a("body").unbind("keydown")}).on("focus",function(i){var h=new Array(33,34,35,36,37,38,39,40);a("body").keydown(function(j){var k=j.which;if(a.inArray(k,h)>-1){j.preventDefault();return false}return true})}).on("keyup",function(k){var j=g.$el.find(".jListItemSelected");if(j.length===0&&(k.keyCode==38||k.keyCode==40)){g.$el.find(".jListOption").first().addClass("jListItemSelected");return}if(k.keyCode==38){var i=j.prev(".jListOption");g.updateSelectItem(i)}else{if(k.keyCode==40){var h=j.next(".jListOption");g.updateSelectItem(h)}}g.$el.focus()});if(this.opts.pScrollEnable&&a().perfectScrollbar!==undefined){this.$el.css("overflow","hidden");this.$el.css("position","relative");this.$el.perfectScrollbar({wheelSpeed:20,wheelPropagation:false})}else{this.$el.css("overflow","auto");this.$el.css("display","block")}};a.fn.listView=function(g){return this.each(function(){new d(this,g)})}})(jQuery,document,window);